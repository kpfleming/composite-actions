name: CI

on:
  push:
    branches:
    - main

jobs:
  preflight:
    runs-on: ubuntu-20.04
    outputs:
      versions: ${{ steps.get_versions.outputs.versions }}
    steps:
    - uses: actions/checkout@v3
    - id: get_versions
      run: cat workflow-support/pdns-versions.json >> $GITHUB_OUTPUT
      shell: bash
  ci-image:
    runs-on: ubuntu-20.04
    needs:
    - preflight
    strategy:
      matrix:
        pdns: ${{ fromJSON(needs.preflight.outputs.versions).pdns }}
    steps:
    - run: echo ${{ matrix.pdns }}
      shell: bash
